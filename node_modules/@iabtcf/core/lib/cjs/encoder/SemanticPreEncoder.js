"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SemanticPreEncoder=void 0;const index_js_1=require("../errors/index.js"),index_js_2=require("../model/index.js");class SemanticPreEncoder{static process(e,s){const r=e.gvl;if(!r)throw new index_js_1.EncodingError("Unable to encode TCModel without a GVL");if(!r.isReady)throw new index_js_1.EncodingError("Unable to encode TCModel tcModel.gvl.readyPromise is not resolved");(e=e.clone()).consentLanguage=r.language.toUpperCase(),(null==s?void 0:s.version)>0&&(null==s?void 0:s.version)<=this.processor.length?e.version=s.version:e.version=this.processor.length;const n=e.version-1;if(!this.processor[n])throw new index_js_1.EncodingError("Invalid version: "+e.version);return this.processor[n](e,r)}}exports.SemanticPreEncoder=SemanticPreEncoder,SemanticPreEncoder.processor=[e=>e,(e,s)=>{e.publisherRestrictions.gvl=s,e.purposeLegitimateInterests.unset(1);const r=new Map;return r.set("legIntPurposes",e.vendorLegitimateInterests),r.set("purposes",e.vendorConsents),r.forEach((r,n)=>{r.forEach((o,t)=>{if(o){const o=s.vendors[t];if(!o||o.deletedDate)r.unset(t);else if(0===o[n].length)if("legIntPurposes"===n&&0===o.purposes.length&&0===o.legIntPurposes.length&&o.specialPurposes.length>0);else if(e.isServiceSpecific)if(0===o.flexiblePurposes.length)r.unset(t);else{const s=e.publisherRestrictions.getRestrictions(t);let o=!1;for(let e=0,r=s.length;e<r&&!o;e++)o=s[e].restrictionType===index_js_2.RestrictionType.REQUIRE_CONSENT&&"purposes"===n||s[e].restrictionType===index_js_2.RestrictionType.REQUIRE_LI&&"legIntPurposes"===n;o||r.unset(t)}else r.unset(t)}})}),e.vendorsDisclosed.set(s.vendors),e}];